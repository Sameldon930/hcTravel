<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="favicon.ico" title="Favicon">
    <title>智慧黄厝</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta itemprop="name" content="智慧黄厝"/>
    <meta itemprop="image" content="../img/config/share.png" />
    <meta name="description" itemprop="description" content="黄厝商家、民宿服务管理、办证申请、会员管理；黄厝旅游景点、商家、民宿汇集及旅游攻略，超值预订打折优惠。" />
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">

    <!-- Styles -->
    <link href="../css/app1.css" rel="stylesheet">
    <link href="../css/hc.common.css" rel="stylesheet">
    <style>
        .van{
            height: 34vh;
            width: 100vw;
            background:#181f23;
            display: flex;
            justify-content: center;
            align-items: center;
            background: url("../img/config/merchant_bgi.jpg") no-repeat;
            background-size: cover;
            position: relative;
        }
        .card-container {
            width: 80vw;
            height: auto;
            background:rgba(255,255,255,0.48);
            min-height: 28vw;
            border-radius: 2vh;
            display: flex;
            align-items: center;
            justify-content:center;
        }
        .card-header {
            padding:10px auto;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            max-width: 60vw;
        }
        .card-header>div{
            line-height: 1.6em;
            max-width: 60vw;
        }
        .cell-icon-title {
            line-height: 2em;
        }
        .merchant-title {
            color: #101010;
            overflow: hidden;
            white-space:nowrap;
            text-overflow: ellipsis;
        }
        .font-fixed{
            margin: auto 0.5em;
        }
        .avatar-item{
            height: 18vw;
            width: 18vw;
            border-radius: 50%;
            border: 1vw solid #fff
        }
        .fix_merchant_bar{
            padding-top: 105px;
        }
    </style>
</head>
<body>
<div id="app" class="init-app" v-cloak>
    <div>
        <van-nav-bar title="我的" fixed/>
    </div>
    <div class="fixed_nav_bar"></div>

    <div>
        <van-cell-group class="van">
            <div class="card-container" v-if="!login_check">
                <div style="padding: 2vh;">
                    <svg width="9vh" height="9vh" viewBox="0 0 0.119751 0.119751" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd">
                        <path style="fill:#444444;" d="M0.0598753 0c0.0330629,0 0.0598753,0.0268124 0.0598753,0.0598753 0,0.0330629 -0.0268124,0.0598753 -0.0598753,0.0598753 -0.0330629,0 -0.0598753,-0.0268124 -0.0598753,-0.0598753 0,-0.0330629 0.0268124,-0.0598753 0.0598753,-0.0598753zm-0.0418843 0.0887664c0,0 0.00214533,-0.012872 0.00668871,-0.0175408 0.00454277,-0.00466943 0.0092122,-0.00744563 0.0112309,-0.00668871 0.00201928,0.000757532 0.0112315,0.0109794 0.0234726,0.0106006 0.0122411,-0.000378766 0.0228411,-0.00858132 0.0235986,-0.00996912 0.000756926,-0.0013884 0.00731897,-0.000757532 0.0121145,0.00542635 0.00479548,0.00618328 0.00694081,0.0186765 0.00694081,0.0186765 0,0 -0.0159136,0.0232217 -0.045052,0.0222108 -0.0291377,-0.00101146 -0.0389941,-0.0227157 -0.0389941,-0.0227157zm0.0418424 -0.0719274c0.0142537,0 0.0258131,0.0115593 0.0258131,0.0258131 0,0.0142543 -0.0115593,0.0258131 -0.0258131,0.0258131 -0.0142537,0 -0.0258131,-0.0115587 -0.0258131,-0.0258131 0,-0.0142537 0.0115593,-0.0258131 0.0258131,-0.0258131z"/>
                    </svg>
                </div>
                <div style="text-align: center;">
                    <div>未登录</div>
                    <div style="font-size: 0.8rem;margin-top: 7px;">登陆获取更多详细信息</div>
                </div>
            </div>
            <div class="card-container" style="right: 5vw;position: absolute;" @click="goMerchantDetail" v-else>
                <div style="padding: 2vw;position: absolute;left: -12vw;margin-top: 1vw">
                    <svg v-if="avatar == ''|| avatar == null" width="20vw" height="20vw" viewBox="0 0 0.182205 0.182205" style="border-radius:50%;ule:shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd">
                        <circle style="fill:#969594;stroke:white;stroke-width:0.0112624;" cx="0.0911023" cy="0.0911023" r="0.0854711"/>
                        <path style="fill:white" d="M0.0394372 0.128075c0,0 0.00265793,-0.0159476 0.00828688,-0.0217319 0.0056282,-0.00578512 0.0114133,-0.00922466 0.0139143,-0.00828688 0.00250176,0.000938534 0.0139151,0.0136027 0.029081,0.0131335 0.015166,-0.000469267 0.0282987,-0.0106317 0.0292372,-0.0123511 0.000937783,-0.00172014 0.00906774,-0.000938534 0.015009,0.0067229 0.00594129,0.00766069 0.00859922,0.023139 0.00859922,0.023139 0,0 -0.019716,0.0287702 -0.0558165,0.0275178 -0.0360998,-0.00125313 -0.0483112,-0.0281432 -0.0483112,-0.0281432zm0.0518401 -0.0891134c0.0176594,0 0.0319807,0.0143213 0.0319807,0.0319807 0,0.0176602 -0.0143213,0.0319807 -0.0319807,0.0319807 -0.0176594,0 -0.0319807,-0.0143205 -0.0319807,-0.0319807 0,-0.0176594 0.0143213,-0.0319807 0.0319807,-0.0319807z"/>
                    </svg>
                    <img v-else :src="avatar" class="avatar-item">
                </div>
                <div class="card-header" style="padding-left: 13vw;">
                    <div><span class="merchant-title">昵称：</span>{{name}}</div>
                    <div><span class="merchant-title">店铺名：</span>{{merchant_short_name}}</div>
                    <div><span class="merchant-title">店铺地址：</span>{{merchant_address}}</div>
                </div>
                <div style="padding: 10px;flex-grow: 1;">
                    <van-icon name="arrow" style="float: right;"/>
                </div>
            </div>
        </van-cell-group>
    </div>
    <div>
        <van-cell-group>
            <a href="merchant_check.html">
            <van-cell is-link>
                <template slot="icon">
                    <svg width="2em" height="2em" viewBox="0 0 0.0176129 0.0176129" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd">
                        <circle style="fill:#0093DD;" cx="0.00880642" cy="0.00880642" r="0.00880644"/>
                        <path style="fill:white;" d="M0.00504087 0.00382519l0.00417445 0c0.000212053,0 0.000385188,0.000172886 0.000385188,0.000385188l0 0.00268659c0,0.000280658 0.000229516,0.000509925 0.000509925,0.000509925l0.00258605 0c0.000212302,0 0.000385188,0.000173135 0.000385188,0.000385438l0 0.00548569c0,0.000280409 -0.000229267,0.000509676 -0.000509676,0.000509676l-0.00753112 0c-0.000280409,0 -0.000509676,-0.000229267 -0.000509676,-0.000509676l0 -0.00894315c0,-0.000280409 0.000229267,-0.000509676 0.000509676,-0.000509676zm0.00176503 0.00434035l0.00397337 0 0 0.000547845 -0.00397337 0 0 -0.000547845zm0 0.0013993l0.00397337 0 0 0.000548095 -0.00397337 0 0 -0.000548095zm0 0.00139955l0.00397337 0 0 0.000548095 -0.00397337 0 0 -0.000548095z"/>
                        <path style="fill:white;" d="M0.0101137 0.00646587l0 -0.00179372c0,-9.55486e-005 5.43854e-005,-0.000177127 0.000142699,-0.000213799 8.83138e-005,-3.64232e-005 0.000184611,-1.74632e-005 0.000251969,5.01443e-005l0.00179422 0.00179422c6.76075e-005,6.76075e-005 8.65675e-005,0.000163905 5.01443e-005,0.000251969 -3.66727e-005,8.83138e-005 -0.000118251,0.000142699 -0.00021355,0.000142699l-0.00179422 -4.98948e-007c-0.000127481,0 -0.000231263,-0.000103781 -0.000231263,-0.000231013z"/>
                    </svg>
                </template>
                <template slot="title">
                    <span class="van-cell-text cell-icon-title font-fixed">商户入驻</span>
                </template>
            </van-cell>
            </a>
        </van-cell-group>
        <div>
            <van-cell-group>
                <a href="verify_list.html">
                    <van-cell is-link>
                        <template slot="icon">
                            <svg width="2em" height="2em" viewBox="0 0 0.0173799 0.0173799">
                                <circle style="fill:#E77817;" cx="0.00868995" cy="0.00868995" r="0.00868997"/>
                                <path style="fill:white;" d="M0.00636805 0.00364388l-0.00316679 0.00819221c0,0 6.12975e-005,0.00185911 0.00155262,0.00189998 0,0 0.00629248,0 0.00629248,0 0,0 0.000792929,3.74186e-005 0.00116441,-0.000878598l0.00196128 -0.00631266c0,0 8.17301e-005,-0.000531245 -0.00032692,-0.000756003 -0.00040865,-0.000224758 -0.000510813,0.000204325 -0.000510813,0.000204325l-0.00194084 0.00678261c0,0 -0.00672107,0 -0.00672107,0 0,0 -0.000560294,-7.40986e-005 -0.000662457,-0.000687074 0,0 0.00650517,3.34798e-005 0.00650517,-6.8929e-005 0,-0.000101916 0.00259444,-0.0074362 0.00259444,-0.0074362 0,0 8.22224e-005,-0.000889676 -0.000592297,-0.000935218l-0.0061492 -4.43115e-006zm0.000348337 0.00279433l0.0034558 0c0.000168137,0 0.000305749,0.000137612 0.000305749,0.000305995l0 0c0,0.000168137 -0.000137612,0.000305749 -0.000305749,0.000305749l-0.0034558 0c-0.000168384,0 -0.000305995,-0.000137612 -0.000305995,-0.000305749l0 0c0,-0.000168384 0.000137612,-0.000305995 0.000305995,-0.000305995zm0.000751572 -0.00133796l0.00345605 0c0.000168137,0 0.000305749,0.000137612 0.000305749,0.000305995l0 0c0,0.000168137 -0.000137612,0.000305749 -0.000305749,0.000305749l-0.00345605 0c-0.000168137,0 -0.000305749,-0.000137612 -0.000305749,-0.000305749l0 0c0,-0.000168384 0.000137612,-0.000305995 0.000305749,-0.000305995z"/>
                            </svg>
                        </template>
                        <template slot="title">
                            <span class="van-cell-text cell-icon-title font-fixed">业务办理</span>
                        </template>
                    </van-cell>
                </a>
            </van-cell-group>
        </div>
        <div style="margin-top: 10px;">
            <van-cell-group>
                <a href="notify.html">
                <van-cell icon="shop" is-link>
                    <template slot="icon">
                        <svg width="2em" height="2em" viewBox="0 0 0.0823679 0.0823679">
                            <circle style="fill:#009688;" cx="0.041184" cy="0.041184" r="0.041184"/>
                            <path style="fill:white;" d="M0.0391624 0.0219469c0,0 -6.31558e-005,-0.00329259 0.00223752,-0.00325863 0.00195518,2.86589e-005 0.00218498,0.00183683 0.00226512,0.00325863 0,0 0.00828456,0.00036036 0.00954502,0.00657351 0.00126099,0.00621368 9.02226e-005,0.0117066 0.00153113,0.0153989 0.00144038,0.0036917 0.00558319,0.00765406 0.0072937,0.00972546 0.00171104,0.00207087 -0.00108692,0.00301662 -0.00108692,0.00301662l-0.0131905 0c0,0 -0.000225556,0.00719923 -0.00614363,0.00701826 -0.00591807,-0.000180445 -0.00664091,-0.00688292 -0.00664091,-0.00688292l-0.0137303 0c0,0 -0.0025671,-0.000766892 -0.000899042,-0.00301874 0,0 0.00621209,-0.00544626 0.00729264,-0.0101288 0.00108055,-0.00468255 -2.01674e-005,-0.0116313 0.00155607,-0.0149233 0.00157624,-0.00329206 0.00456739,-0.00650876 0.00997013,-0.0067789z"/>
                        </svg>
                    </template>
                    <template slot="title">
                        <span class="van-cell-text cell-icon-title font-fixed">消息通知</span>
                    </template>
                </van-cell>
                </a>
            </van-cell-group>
        </div>
        <div>
            <van-cell-group>
                <a href="feedback.html">
                    <van-cell is-link>
                        <template slot="icon">
                            <svg width="2em" height="2em" viewBox="0 0 0.0175075 0.0175075">
                                <circle style="fill:#974578;" cx="0.00875371" cy="0.00875375" r="0.00875373"/>
                                <path style="fill:white" d="M0.00723733 0.00884028l0 0.0040959 -0.00194343 0c0,0 -0.00120841,-0.000424544 -0.00128305,-0.00139861l0 -0.00457054c0,0 0.000694595,-0.0041827 0.0046432,-0.00398406 0.0039486,0.000198633 0.00484257,0.0034023 0.00484257,0.0040478l0 0.00618366c0,0 -7.43943e-005,0.000769733 -0.00131628,0.00131628l-0.00342685 0 0 -0.0011174 0.00367533 0 0 -0.000471908c0,0 -0.00217752,0.000122007 -0.00221026,0 -3.27335e-005,-0.000122007 0,-0.00407259 0,-0.00407259 0,0 0.00225117,0 0.00225117,0 0,0 0.000257156,-0.00444481 -0.00371624,-0.00466824 -0.000373707,0 -0.00397365,4.88523e-005 -0.00362598,0.0045936l0.00210982 4.61245e-005z"/>
                            </svg>
                        </template>
                        <template slot="title">
                            <span class="van-cell-text cell-icon-title font-fixed">投诉建议</span>
                        </template>
                    </van-cell>
                </a>
            </van-cell-group>
        </div>
        <div>
            <van-cell-group>
                <a href="process.html">
                    <van-cell is-link>
                        <template slot="icon">
                            <svg width="2em" height="2em" viewBox="0 0 0.0130851 0.0130851">
                                <circle style="fill:#DA251D;" cx="0.00654253" cy="0.00654253" r="0.00654253"/>
                                <path style="fill:white" d="M0.00849121 0.00466818c0,0.000216107 -0.00017941,0.000392367 -0.000400707,0.000392367l-0.00309019 0c-0.000221297,0 -0.000400522,-0.000176259 -0.000400522,-0.000392367l0 -0.00101381c0,-0.000215922 0.000179225,-0.000392181 0.000400522,-0.000392181l0.00309019 -1.85341e-007c0.000221297,0 0.000400707,0.000176444 0.000400707,0.000392552l0 0.00101363z"/>
                                <path style="fill:white" d="M0.00451509 0.00834849c0,-0.000215922 -0.000179781,-0.000392181 -0.000400522,-0.000392181l-0.00188788 0c-0.000220926,0 -0.000400522,0.000176259 -0.000400522,0.000392367l0 0.00108424c0,0.000215922 0.000179595,0.000390142 0.000400336,0.000390142l0.00188807 -1.85341e-007c0.000220926,0 0.000400522,-0.000174035 0.000400522,-0.000389957l0 -0.00108443z"/>
                                <path style="fill:white" d="M0.00788699 0.00834849c0,-0.000215922 -0.000179225,-0.000392181 -0.000400336,-0.000392181l-0.0018877 0c-0.000221297,0 -0.000400522,0.000176259 -0.000400522,0.000392367l0 0.00108424c0,0.000215922 0.000179225,0.000390142 0.000400336,0.000390142l0.00188788 -1.85341e-007c0.000221112,0 0.000400336,-0.000174035 0.000400336,-0.000389957l0 -0.00108443z"/>
                                <path style="fill:white" d="M0.0112589 0.00834849c0,-0.000215922 -0.000179039,-0.000392181 -0.000400336,-0.000392181l-0.00188751 0c-0.000221112,0 -0.000400522,0.000176259 -0.000400522,0.000392367l0 0.00108424c0,0.000215922 0.00017941,0.000390142 0.000400522,0.000390142l0.00188751 -1.85341e-007c0.000221297,0 0.000400336,-0.000174035 0.000400336,-0.000389957l0 -0.00108443z"/>
                                <path style="fill:white" d="M0.00956192 0.00636738l-0.00282608 0 0 -0.000914657 -0.00035326 0 0 0.000914657 -0.00304886 0c-0.000299325,0 -0.000541381,0.000235754 -0.000541381,0.000528963l0 0.000764716 0.000282274 0 0 -0.000764716c0,-0.000141044 0.000115838,-0.000253546 0.000259106,-0.000253546l0.00304886 0 0 0.00101826 0.00035326 0 0 -0.00101826 0.00282608 0c0.000143639,0 0.000259292,0.000112502 0.000259663,0.000253546l1.85341e-007 0.000764716 0.000282459 0 0 -0.000764716c-3.70682e-007,-0.000293209 -0.000242982,-0.000528963 -0.000542307,-0.000528963z"/>
                            </svg>
                        </template>
                        <template slot="title">
                            <span class="van-cell-text cell-icon-title font-fixed">流程说明</span>
                        </template>
                    </van-cell>
                </a>
            </van-cell-group>
        </div>
    </div>

    <div class="fix_merchant_bar"></div>
    <div style="position: fixed;bottom: 50px;width: 100vw;" @click="logout" v-show="login_check">
        <van-button size="normal" bottom-action style="background-color: #ff0000;">安全退出</van-button>
    </div>
    <div>
        <van-tabbar v-model="active">
            <van-tabbar-item icon="wap-home" @click="homePage">首页</van-tabbar-item>
            <van-tabbar-item icon="contact">我的</van-tabbar-item>
        </van-tabbar>
    </div>
</div>
<script src="../js/app1.js"></script>
<script src="../js/hc.common.js"></script>
<script>
    var obj = JSON.parse(window.localStorage.getItem('HC.merchant'));
    var base_url = '../storage';
    var app = new Vue({
        el:"#app",
        data() {
            return {
                active: 1,
                token: '',
                avatar: '',
                merchant_id: '',
                name: '未设置',
                merchant_short_name: '未设置',
                merchant_address: '未设置',
                login_check: false,
                computedTime: 0
            };
        },
        methods: {
            homePage() {
                location.href = '../index.html';
            },
            goMerchantDetail(){
                location.href = 'merchant_detail.html'
            },
            logout(){
                this.$dialog.confirm({
                    title: '安全退出',
                    message: '确定安全退出登录？'
                }).then(() => {

                    window.localStorage.removeItem('HC.merchant');
                    this.login_check = false;
                    this.$toast('退出登录成功！');

                    this.computedTime = 2;
                    this.timer = setInterval(() => {
                        this.computedTime--;
                        if (this.computedTime == 0) {
                            clearInterval(this.timer);
                            window.location.href = '../index.html';
                        }
                    }, 1000);
                });

            }
        },
        mounted () {
            if (obj == null) {
                this.login_check = false;
                this.$dialog.confirm({
                    title: '请先登录',

                }).then(() => {
                    window.location.href = 'login.html';
                }).catch(() => {
                    window.location.href = '../index.html';
                });
            } else {
                this.login_check = true;
            }
            let post_data = {
                method: 'merchant.get.one',
                nonce: 'merchant.get.one',
                merchant_id: obj.data.id,
                token: obj.data.api_token,
            }
            axios.post('/api/v1',api_data_sign(post_data, 'hc')).then(response => {
                console.log(response.data)
                if (response.data.code == '200') {
                    let merchantInfo = response.data.data.merchant_info;
                    let merchant =response.data.data;
                    console.log(merchantInfo);
                    this.name = merchant.name == null? '未设置' : merchant.name;
                    this.avatar = merchant.avatar == null ? '': base_url + merchant.avatar;
                    this.merchant_short_name = merchantInfo.merchant_short_name == null ? '未设置' : merchantInfo.merchant_short_name;
                    this.merchant_address = merchantInfo.merchant_address == null ? '未设置' : merchantInfo.merchant_address;
                }else {
                    if(response.data.code == '005') {
                        this.login_check = false;
                        window.localStorage.removeItem('HC.merchant');
                        this.$dialog.confirm({
                            title: '请重新登录',
                            message: response.data.msg
                        }).then(() => {
                            window.location.href = 'login.html';
                        }).catch(() => {
                            window.location.href = '../index.html';
                        });
                    }
                }
            }).catch(error => {
                console.log(error);
            });

        }
    });
</script>

</body>
</html>
